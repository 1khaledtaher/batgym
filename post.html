<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙˆØ³Øª | BATGYM</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>
  <script src="https://unpkg.com/feather-icons"></script>
  <style>
    body {
      background: #121212;
    }
    .post-details-card {
      background: #1F2128;
      color: #F5F5F5;
      border-radius: 0;
      box-shadow: none;
      padding: 0;
      margin: 0;
      max-width: 100vw;
      width: 100vw;
      margin-left: 0;
      margin-right: 0;
      font-size: 1.18rem;
      position: relative;
      border: none;
    }
    .post-details-header {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 18px 22px 8px 22px;
    }
    .post-details-header img {
      width: 54px;
      height: 54px;
      border-radius: 50%;
      object-fit: cover;
      border: 2.5px solid rgba(212, 175, 55, 0.3);
    }
    .post-details-img {
      width: 100vw;
      max-width: 100vw;
      min-width: 100vw;
      max-height: 420px;
      object-fit: cover;
      display: block;
      border-radius: 0;
      margin-bottom: 0;
    }
    .post-details-body {
      padding: 18px 18px 0 18px;
    }
    .post-details-text {
      font-size: 1.25rem;
      margin-bottom: 12px;
      word-break: break-word;
      line-height: 2.1;
    }
    .post-details-time {
      font-size: 1.05rem;
      color: rgba(212, 175, 55, 0.6);
      margin-bottom: 8px;
      text-align: left;
    }
    .post-details-actions {
      display: flex;
      align-items: center;
      gap: 18px;
      margin: 10px 0 0 0;
      padding: 0 28px 8px 28px;
      border-top: 1.5px solid rgba(212, 175, 55, 0.1);
      border-bottom: 1.5px solid rgba(212, 175, 55, 0.1);
      background: #1F2128;
      justify-content: flex-start;
    }
    .like-btn, .comment-btn {
      background: none;
      border: none;
      color: #D4AF37;
      font-size: 1.35rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 6px;
      transition: color 0.18s;
      padding: 8px 18px;
      border-radius: 12px;
      font-weight: bold;
    }
    .like-btn.liked {
      color: #F4D03F;
    }
    .like-btn span, .comment-btn span {
      font-size: 1.13rem;
      font-weight: bold;
    }
    .comments-title {
      color: rgba(212, 175, 55, 0.8);
      font-size: 1.13rem;
      margin: 18px 0 8px 0;
      text-align: right;
      font-weight: bold;
      padding-right: 8px;
    }
    .comments-section {
      max-width: 100vw;
      margin: 0;
      background: #1F2128;
      border-radius: 0;
      box-shadow: none;
      padding: 0 0 18px 0;
    }
    .comment-card {
      background: #1F2128;
      border-radius: 0;
      padding: 16px 18px;
      margin-bottom: 7px;
      display: flex;
      align-items: center;
      gap: 10px;
      box-shadow: none;
      width: 100vw;
      max-width: 100vw;
      min-width: 0;
      position: relative;
      justify-content: space-between;
    }
    .comment-card .comment-text {
      flex: 1;
      font-size: 1.13rem;
      color: #F5F5F5;
      word-break: break-word;
    }
    .comment-actions {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-right: 8px;
    }
    .comment-like-btn {
      background: none;
      border: none;
      color: #A9A9A9;
      font-size: 1.15rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 3px;
      transition: color 0.18s;
      padding: 2px 6px;
      border-radius: 50%;
    }
    .comment-like-btn.liked {
      color: #F4D03F;
    }
    .comment-like-btn span {
      font-size: 1.01rem;
      font-weight: bold;
    }
    .delete-comment-btn {
      background: none;
      border: none;
      color: #e53935;
      font-size: 1.18rem;
      cursor: pointer;
      margin-right: 2px;
      padding: 2px 6px;
      border-radius: 50%;
      transition: background 0.18s;
    }
    .delete-comment-btn:hover {
      background: rgba(229, 57, 53, 0.2);
    }
    #add-comment-form {
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 0;
      margin-top: 0;
      max-width: 100vw;
      margin-left: 0;
      margin-right: 0;
      background: #1F2128;
      border-radius: 0;
      box-shadow: none;
      padding: 0 0 0 0;
      border-top: 1.5px solid rgba(212, 175, 55, 0.1);
      border-bottom: 1.5px solid rgba(212, 175, 55, 0.1);
      position: sticky;
      bottom: 0;
      z-index: 10;
    }
    #comment-input {
      flex: 1;
      border-radius: 0;
      border: none;
      padding: 16px 18px;
      font-size: 1.13rem;
      background: #1F2128;
      color: #A9A9A9;
      font-family: Cairo, Tahoma, Arial, sans-serif;
      resize: none;
      outline: none;
    }
    #comment-input::placeholder {
      color: rgba(212, 175, 55, 0.5);
    }
    #comment-submit {
      background: #D4AF37;
      color: #121212;
      border: none;
      padding: 16px 22px;
      font-size: 1.13rem;
      font-weight: bold;
      cursor: pointer;
      border-radius: 0;
      transition: background 0.18s;
      font-family: Cairo, Tahoma, Arial, sans-serif;
    }
    #comment-submit:hover {
      background: #F4D03F;
    }
    .back-btn {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(31, 33, 40, 0.9);
      color: #D4AF37;
      border: none;
      padding: 12px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1.1rem;
      font-weight: bold;
      z-index: 100;
      backdrop-filter: blur(10px);
      box-shadow: none;
      transition: all 0.2s;
    }
    .back-btn:hover {
      background: rgba(212, 175, 55, 0.1);
      transform: translateY(-2px);
    }
    .heart-animation {
      position: fixed;
      font-size: 4rem;
      color: #F4D03F;
      pointer-events: none;
      z-index: 1000;
      animation: heartBeat 0.6s ease-out forwards;
    }
    @keyframes heartBeat {
      0% {
        transform: scale(0) rotate(0deg);
        opacity: 1;
      }
      50% {
        transform: scale(1.2) rotate(180deg);
        opacity: 1;
      }
      100% {
        transform: scale(0) rotate(360deg);
        opacity: 0;
      }
    }
  </style>
</head>
<body class="bat-dark">
  <button class="back-btn" onclick="history.back()">
    <i data-feather="arrow-right"></i>
  </button>
  
  <div id="post-details-container">
    <!-- Ø³ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¨ÙˆØ³Øª Ù‡Ù†Ø§ -->
  </div>

  <script src="script.js"></script>
  <script>
    // ØªÙØ¹ÙŠÙ„ Feather Icons
    feather.replace();
    
    // Ø¯Ø§Ù„Ø© ØªØ­Ù…ÙŠÙ„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†Ø´ÙˆØ±
    function loadPostDetails() {
      const urlParams = new URLSearchParams(window.location.search);
      const postId = urlParams.get('id');
      
      if (!postId) {
        document.getElementById('post-details-container').innerHTML = '<div style="text-align:center;padding:50px;color:#A9A9A9;">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†Ø´ÙˆØ±</div>';
        return;
      }
      
      firebase.database().ref('mainPosts/' + postId).once('value', snap => {
        const post = snap.val();
        if (!post) {
          document.getElementById('post-details-container').innerHTML = '<div style="text-align:center;padding:50px;color:#A9A9A9;">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†Ø´ÙˆØ±</div>';
          return;
        }
        
        renderPostDetails(post);
      });
    }
    
    // Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†Ø´ÙˆØ±
    function renderPostDetails(post) {
      const user = firebase.auth().currentUser;
      const liked = user && post.likes && post.likes[user.uid];
      const comments = post.comments || [];
      
      const postHTML = `
        <div class="post-details-card">
          <div class="post-details-header">
            <img src="${post.author?.avatar || 'https://www.gravatar.com/avatar/?d=mp&s=80'}" alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
            <div>
              <div style="font-weight:bold;color:#D4AF37;font-size:1.1rem;">${post.author?.name || 'Ù…Ø¬Ù‡ÙˆÙ„'}</div>
              <div class="post-details-time">${formatPostTime(post.time)}</div>
            </div>
          </div>
          
          ${post.img ? `<img src="${post.img}" class="post-details-img" alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†Ø´ÙˆØ±">` : ''}
          
          <div class="post-details-body">
            <div class="post-details-text">${post.text}</div>
          </div>
          
          <div class="post-details-actions">
            <button class="like-btn${liked ? ' liked' : ''}" data-id="${post.id}">
              ${liked ? 'â¤ï¸' : 'ğŸ¤'} <span>${post.likes ? Object.keys(post.likes).length : 0}</span>
            </button>
            <button class="comment-btn">
              ğŸ’¬ <span>${comments.length}</span>
            </button>
          </div>
          
          <div class="comments-section">
            <div class="comments-title">Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª (${comments.length})</div>
            <div id="comments-list">
              ${comments.map(comment => `
                <div class="comment-card">
                  <div class="comment-text">${comment.text}</div>
                  <div class="comment-actions">
                    <button class="comment-like-btn">
                      ğŸ¤ <span>0</span>
                    </button>
                    ${user && comment.uid === user.uid ? 
                      `<button class="delete-comment-btn" data-id="${comment.id}">ğŸ—‘ï¸</button>` : ''}
                  </div>
                </div>
              `).join('')}
            </div>
            
            ${user ? `
              <form id="add-comment-form">
                <input type="text" id="comment-input" placeholder="Ø§ÙƒØªØ¨ ØªØ¹Ù„ÙŠÙ‚Ùƒ..." required>
                <button type="submit" id="comment-submit">Ø¥Ø±Ø³Ø§Ù„</button>
              </form>
            ` : ''}
          </div>
        </div>
      `;
      
      document.getElementById('post-details-container').innerHTML = postHTML;
      
      // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
      addPostEventListeners(post);
    }
    
    // Ø¯Ø§Ù„Ø© Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
    function addPostEventListeners(post) {
      const user = firebase.auth().currentUser;
      
      // Ø²Ø± Ø§Ù„Ù„Ø§ÙŠÙƒ
      const likeBtn = document.querySelector('.like-btn');
      if (likeBtn && user) {
        likeBtn.addEventListener('click', function() {
          const postId = this.dataset.id;
          const likeRef = firebase.database().ref('mainPosts/' + postId + '/likes/' + user.uid);
          likeRef.once('value', snap => {
            if (snap.exists()) {
              likeRef.remove(() => loadPostDetails());
            } else {
              likeRef.set(true, () => loadPostDetails());
            }
          });
        });
      }
      
      // Ø¥Ø¶Ø§ÙØ© ØªØ¹Ù„ÙŠÙ‚
      const commentForm = document.getElementById('add-comment-form');
      if (commentForm && user) {
        commentForm.addEventListener('submit', function(e) {
          e.preventDefault();
          const input = document.getElementById('comment-input');
          const text = input.value.trim();
          
          if (!text) return;
          
          const commentObj = {
            text: text,
            uid: user.uid,
            name: user.displayName,
            id: Date.now()
          };
          
          const commentsRef = firebase.database().ref('mainPosts/' + post.id + '/comments');
          commentsRef.once('value', snap => {
            let comments = snap.val() ? Object.values(snap.val()) : [];
            comments.push(commentObj);
            commentsRef.set(comments, () => {
              input.value = '';
              loadPostDetails();
            });
          });
        });
      }
      
      // Ø­Ø°Ù ØªØ¹Ù„ÙŠÙ‚
      document.querySelectorAll('.delete-comment-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const commentId = +this.dataset.id;
          const commentsRef = firebase.database().ref('mainPosts/' + post.id + '/comments');
          commentsRef.once('value', snap => {
            let comments = snap.val() ? Object.values(snap.val()) : [];
            comments = comments.filter(c => c.id !== commentId);
            commentsRef.set(comments, () => loadPostDetails());
          });
        });
      });
    }
    
    // Ø¯Ø§Ù„Ø© ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙˆÙ‚Øª
    function formatPostTime(postTime) {
      const now = Date.now();
      const diff = now - postTime;
      const minutes = Math.floor(diff / 60000);
      const hours = Math.floor(diff / 3600000);
      const days = Math.floor(diff / 86400000);
      
      if (minutes < 1) return 'Ø§Ù„Ø¢Ù†';
      if (minutes < 60) return `Ù…Ù†Ø° ${minutes} Ø¯Ù‚ÙŠÙ‚Ø©`;
      if (hours < 24) return `Ù…Ù†Ø° ${hours} Ø³Ø§Ø¹Ø©`;
      if (days < 7) return `Ù…Ù†Ø° ${days} ÙŠÙˆÙ…`;
      
      const date = new Date(postTime);
      return date.toLocaleDateString('ar-EG', {
        year: 'numeric',
        month: 'short',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
    }
    
    // Ø¯Ø§Ù„Ø© Ø¥Ù†Ø´Ø§Ø¡ ØªØ£Ø«ÙŠØ± Ø§Ù„Ù‚Ù„Ø¨ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø§Ù„Ù…Ø²Ø¯ÙˆØ¬
    function createHeartAnimation(x, y) {
      const heart = document.createElement('div');
      heart.className = 'heart-animation';
      heart.innerHTML = 'â¤ï¸';
      heart.style.left = x + 'px';
      heart.style.top = y + 'px';
      document.body.appendChild(heart);
      
      setTimeout(() => {
        document.body.removeChild(heart);
      }, 600);
    }
    
    // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ø§Ù„Ø¶ØºØ· Ø§Ù„Ù…Ø²Ø¯ÙˆØ¬ Ù„Ù„Ø¨ÙˆØ³Øª
    document.addEventListener('DOMContentLoaded', function() {
      const postContainer = document.getElementById('post-details-container');
      let lastClickTime = 0;
      
      postContainer.addEventListener('click', function(e) {
        const currentTime = new Date().getTime();
        const timeDiff = currentTime - lastClickTime;
        
        if (timeDiff < 300 && timeDiff > 0) {
          // Ø¶ØºØ· Ù…Ø²Ø¯ÙˆØ¬ - Ø¥Ù†Ø´Ø§Ø¡ ØªØ£Ø«ÙŠØ± Ø§Ù„Ù‚Ù„Ø¨
          createHeartAnimation(e.clientX - 50, e.clientY - 50);
          
          // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø²Ø± Ø§Ù„Ù„Ø§ÙŠÙƒ Ø§Ù„Ø£Ù‚Ø±Ø¨ ÙˆØ§Ù„Ø¶ØºØ· Ø¹Ù„ÙŠÙ‡
          const likeBtn = e.target.closest('.like-btn') || 
                         e.target.closest('.post-details-actions')?.querySelector('.like-btn');
          if (likeBtn) {
            likeBtn.click();
          }
        }
        
        lastClickTime = currentTime;
      });
      
      // ØªØ­Ù…ÙŠÙ„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
      loadPostDetails();
    });
  </script>
</body>
</html> 